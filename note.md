# 正規表現の基本と実例
## （原稿）

文中の意味。
マッチ：一致すること。検索でヒットした場合、選択される文字列と考えて問題ない。
文字：1文字を指す。「あ」「A」「!」
文字列：ひとかたまりの文字を指す。「あいう」「ABC」「!#?」

正規表現："Regular Expression"。略語は"RegEx"または"RegExp"が一般的。（略語の発音はネイティブにも不明）

## 基本のメタキャラクタ

1文字で意味を成すもの。

文中では\がたびたび登場し、それは表示環境によってバックスラッシュ（反対向きのスラッシュ）や円記号になりますが、
全てBackSpaceの1つ左のキーで入力出来る文字です。また、右Shiftの1つ左のキーでも同じ文字が入力出来ます。

| 表現 | 意味 | マッチする文字 | 代替表現 |
| :--- | :--- | :--- | :--- |
| . | 任意の1文字にマッチする。 | あ or A or ! |
| \t | タブ |  |
| \r | 改行（CR）Macは多分これ。 | （改行） |
| \n | 改行（LF）Windowsはエディタによってこれの場合がある。 | （改行） |
| \r\n | 改行（CRLF）Windowsは大体これ。 | （改行） |
| \d | 全ての数字 | 0～9 | [0-9]
| \s | 垂直タブ以外の全ての空白文字 | （スペース等） | [ \t\f\r\n] |
| \w | 英数字、アンダーバー | a\~z A\~Z 0~9 _ | [a-zA-Z0-9_] |
| \D | 全ての数字以外 | 0～9以外 | [^0-9] |
| \S | 垂直タブ以外の全ての空白文字以外 | （スペース等）以外 | [^ \t\f\r\n] |
| \W | 英数字、アンダーバー以外 | a\~z A\~Z 0~9 _以外 | [^a-zA-Z0-9_] |

## コンボパーツ
### 文字パーツ

1文字で意味を成すものもあるけれど、基本的に組み合わせることで真価を発揮する文字達。

| 表現 | 意味 | 記述例 | マッチする文字列 |
| :--- | :--- | :--- | :--- |
| \+ | **直前の文字**が**1回以上**繰り返す文字列にマッチ。**最長一致**。 | g**o+**gle | gogle google gooogle |
| \* | **直前の文字**が**0回以上**繰り返す文字列にマッチ。**最長一致**。 | g**o\***gle | ggle gogle google gooogle |
| ? | **直前の文字**が**0または1文字**の場合にマッチ。**最長一致**。 | go**o?**gle | gogle google |
| \ | **直後の文字**の**正規表現的意味合いを無視**させます。 | go**+**gle | go+gle |

### 複数文字パーツ
| 表現 | 意味 | 記述例 | マッチする文字列 |
| :--- | :-- | :-- | :-- |
| (...) | ()の中の文字を**文字列とする**。 | **(**cure**)** | precure -> cure |
| [...] | []の中に含まれる**いずれかの文字**とマッチする。 | **[**cure**]** | precure -> c u r e |
| [^...] | []の中に含まれる**文字以外**とマッチする。 | **[^**cure**]** | precure -> p  |
| {n}  | 直前の文字の**桁数を指定**。 | オヨ**{2}** | オヨヨ |
| {n,} | 直前の文字の**最小桁数を指定**。 | オヨ**{2,}** | オヨヨ オヨヨヨ オヨヨヨヨ... |
| {nA,nB}| 直前の文字の**最小桁数(nA)と最大桁数(nB)を指定**。 | オヨ**{2,3}** | オヨヨ オヨヨヨ |

### 位置指定パーツ

| 表現 | 意味 | 記述例 | マッチする文字列 |
| :--- | :-- | :-- | :-- |
| ^ | **直後の文字**が**行頭**にある場合にマッチ。 | ^キ | キュアハッピー キュアマーチ |
| $ | **直前の文字**が**行末**にある場合にマッチ。 | チ$ | キュアマーチ キュアピーチ |

#### 最長一致と最短一致について
正規表現はそのまま使うと最長一致の文字列を選択します。

例えば以下のテキストがあるとします。

```text:プリキュア
キュアハニー キュアラブリー キュアハッピー
```

正規表現で検索した結果マッチする文字列は「」中のものとします。
**「キ」で始まって「ー」で終わる**文字列を検索するために、`キ.*ー`で検索した場合、

```text:プリキュア
「キュアハニー キュアラブリー キュアハッピー」
```

と、3つの単語は1つの文字列としてマッチします。
これは**「キ」で始まって「ー」で終わる文字列**という表現とマッチしているためです。

ですが、本当は**「キ」で始まって「ー」で終わる単語**単位で検索したかった場合、選択する方法はいくつか考えられます。

1. キュアハニーは`キュアハニー`で検索して、各々別々に三回検索する。
1. `キ.*ー`に半角スペースを加えて`キ.*ー `として検索する。

等ですが、
1.の場合、
単語数が増加するほど回数も増加しますし、入力もその都度行います。

2.の場合、
"キュアハニー"と"キュアラブリー"の場合は選択出来ますが、末尾に半角スペースが混じってしまいます。
また、"キュアハッピー"の場合、半角スペースを持たないので選択することが出来ません。

この、**正規表現で解釈可能な最長の文字列**にマッチさせるのが、最長一致です。

**でも、どうしても**

```text:プリキュア
「キュアハニー」 「キュアラブリー」 「キュアハッピー」
```
と、マッチさせたいとします。
その場合、正規表現文字**?**を足し、`キ.*?ー`とします。
すると

```text:プリキュア
「キュアハニー」 「キュアラブリー」 「キュアハッピー」
```
とマッチさせることが出来ます。

この、**正規表現で解釈可能な最短の文字列**にマッチさせるのが、最短一致です。
とても便利ですが、`?`も`*`も、正規表現として1文字で意味をなすので、少し分かりづらいかなと思います。

最短一致は`キ.*?ー`の場合、`*?`で1つの正規表現と捉えられると理解しやすいと思います。

| 表現 | 意味 | 記述例 | マッチする文字列 |
| :--- | :--- | :--- | :--- |
| \+? | **直前の文字**が**1回以上**繰り返す文字列にマッチ。**最短一致。** | キュ.**+?**ー | キュアハニー キュアー |
| \*? | **直前の文字**が**0回以上**繰り返す文字列にマッチ。**最短一致。** | キュ.**\*?**ー | キュアハニー キュアー キュー |
| ?? | **直前の文字**が**0または1文字**の場合にマッチ。**最短一致。** | キュ**??**ー | キュアー キュー |

> キュアハニー キュアー キュー キー


また、こんなものもあります。

| 表現 | 意味 | 記述例 | マッチする文字列 |
| :--- | :--- | :--- | :--- |
| {nA,nB}? | 直前の文字の**最小桁数(nA)と最大桁数(nB)を指定**。**最短一致**。 | オヨ**{3,4}?** | オヨヨヨ オヨヨヨヨ |

これは桁数一致`{nA}`とほとんど同じ文字列がマッチするので、いまいち使いどころが分かりませんが。
最大桁数が明らかで、かつ、少ない桁数で揃うとき、有効なのかもしれません。
`[0-9]{8,32}?`とか。

```text:numLine
0123456789
0123456789abc
01234567
0123456789abcdef
```

`[0-9a-f]{5}`と`[0-9a-f]{5,16}?`は同じ。やっぱり謎。


#### 単語の先頭/末尾

単語の先頭か末尾をキーにした正規表現です。
ただし、日本語は相性が悪いので使いづらいです。
コードであれば活用出来るかもしれませんが、代替表現はたくさんあります。

| 表現 | 意味 | 記述例 | 文字列中のマッチする文字 |
| :--- | :--- | :--- | :--- |
| \b | 単語の先頭にマッチ | **\b**p | **p**recure |
| \b | 単語の末尾にマッチ | e**\b** | **p**recure |
| \B | 単語の先頭以外にマッチ | **\B**e | pr**e**cur**e** |
| \B | 単語の末尾以外にマッチ | p**\B** | **p**recure |


### 置換文字列で使える正規表現

例文
```text:おとめ座レインボースプラッシュ！
「 プリンセススターカラーペン！おとめ座！くるくるチャージ！ 」
→「 (プリンセススターカラーペン！).*(座！くるくるチャージ！) 」
```
→置換操作にて、置換文字列に`$1かに$2`を入力。
```text:かに座レインボースプラッシュ！
→「 プリンセススターカラーペン！かに座！くるくるチャージ！ 」
```


| 表現 | 意味 | 記述例 | マッチする文字列 |
|:---|:---|:---|:---|
| $1\~9 | ()で囲んでおいた文字列を出力する | 上記 | **$1**：プリンセススターカラーペン！<br>**$2**：座！クルクルチャージ！ |

これを利用することで前後の文字列からマッチさせたい文字を求めつつ、
前後の文字列に影響を与えることなくマッチさせた文字の置換が行えます。

端的に言うと変数として利用出来ます。
()で囲んだ順番で1\~9が対応します。
( ()())と複数回利用した場合は、
(1 (2) (3))と、外丸括弧内が1、中丸括弧内がそれぞれ列順に2、3となります。



### コンボ集

| コンボ | 意味合い | マッチする文字列例 |
|:--|:--|:--|
| ... | とにかく3文字 | ABC あいう 肉団子 チョコ !?. |
| .ン | 「ン」で終わる2文字 | ゴン ガン ！ン Aン |
| キ.ア | 「キ」で始まって「ア」で終わる3文字 | キルア キュア キPア キ！ア |
| クラピ. | 「クラピ」で始まる4文字 | クラピカ クラピオ クラピB クラピ？ |
| .オリ. | 「オリ」を含む4文字 | レオリオ リオリオ AオリB ！オリ＃ |
| キ.*ー | 「キ」で始まって「ー」で終わる文字列 | キュアハッピー キュアラブリー |
